<%- include('partials/header', { title: '管理员页面 - 英语题库' }) %>

<div class="card">
    <h2 style="margin-bottom: 1.5rem;">题目管理</h2>
    
    <% if (problems.length === 0) { %>
        <p style="text-align: center; color: #7f8c8d; padding: 2rem;">暂无题目</p>
    <% } else { %>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>题目名称</th>
                        <th>发布者</th>
                        <th>题目数量</th>
                        <th>创建时间</th>
                        <th>状态</th>
                        <th>删除原因</th>
                        <th>答题次数</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <% problems.forEach(problem => { %>
                        <tr class="<%= problem.is_approved === 0 ? 'table-row-deleted' : '' %>">
                            <td><%= problem.id %></td>
                            <td>
                                <% if (problem.is_approved === 0) { %>
                                    <span style="color: #999;"><%= problem.title %></span>
                                <% } else { %>
                                    <a href="/problem/<%= problem.id %>"><%= problem.title %></a>
                                <% } %>
                            </td>
                            <td><%= problem.username %></td>
                            <td><%= problem.questionCount %></td>
                            <td><%= new Date(problem.created_at).toLocaleDateString() %></td>
                            <td>
                                <% if (problem.is_approved === 0) { %>
                                    <span class="status-badge status-deleted">已删除</span>
                                <% } else { %>
                                    <span class="status-badge status-active">正常</span>
                                <% } %>
                            </td>
                            <td>
                                <% if (problem.is_approved === 0 && problem.delete_reason) { %>
                                    <span style="color: #e74c3c;"><%= problem.delete_reason %></span>
                                <% } else if (problem.is_approved === 0) { %>
                                    <span style="color: #999;">无具体原因</span>
                                <% } else { %>
                                    <span style="color: #999;">-</span>
                                <% } %>
                            </td>
                            <td><%= problem.attempts || 0 %></td>
                            <td>
                                <% if (problem.is_approved === 1) { %>
                                    <form action="/admin/delete-problem/<%= problem.id %>" method="POST" style="display: inline-block;">
                                        <div class="form-group" style="margin-bottom: 0.5rem;">
                                            <input type="text" name="reason" class="form-control form-control-sm" placeholder="删除原因" required>
                                        </div>
                                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('确定要删除这个题目吗？')">
                                            <i class="fas fa-trash"></i> 删除
                                        </button>
                                    </form>
                                <% } else { %>
                                    <span style="color: #7f8c8d;">已删除</span>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        
        <div style="margin-top: 2rem; padding: 1rem; background-color: #f8f9fa; border-radius: 6px;">
            <h4 style="color: #7f8c8d; margin-bottom: 0.5rem;">管理员操作说明</h4>
            <ul style="margin: 0; padding-left: 1.5rem; color: #666; font-size: 0.9rem;">
                <li>删除题目需要填写删除原因，原因将显示给发布者</li>
                <li>删除后的题目将不再显示在题目列表中</li>
                <li>发布者可以在个人主页查看被删除的题目及原因</li>
                <li>发布者可以选择永久删除这些记录</li>
            </ul>
        </div>
    <% } %>
</div>

<%- include('partials/footer') %>